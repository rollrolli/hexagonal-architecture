# 1-2. 도메인 헥사곤으로 비즈니스 규칙 감싸기

도메인 헥사곤은 어떤 헥사곤에도 의존하지 않는다.

### 도메인 엔티티의 순수성

- 문제 영역 모델링의 핵심은 엔티티를 만드는 것이다.
- 가능한 한 정확하게 실제 시나리오를 코드로 옮기는 것
- 도메인 엔티티는 비즈니스 관심사만 처리한다는 점에서 순수
- 포트, 유스케이스, 어댑터를 활용할 수 있는 특권이 있다.

### 관련 엔티티

- 비즈니스 규칙과 비즈니스 데이터라는 두 요소의 존재는 관련 엔티티의 특징을 결정한다.
- 규칙이 여기저기 누출된 엔티티를 `빈약한 도메인 모델`이라고 한다.
- 본질적인 로직은 엔티티에 포함시키고, 본질적이지 않은 로직은 도메인 서비스에서 처리하도록 한다.

### UUID를 이용한 식별자 정의

- 엔티티는 식별자가 필요하다.
- Auto increment같이 DB에 식별자 생성 책임을 위임하면 편하지만 소프트웨어 중요 부분이 외부 시스템과 결합하고 있음을 의미한다.
- UUID를 사용하여 중앙 기관에 의존하지 않는 식별자를 만든다.
- UUID 생성 방법
    - 시간 기반
    - 분산 컴퓨터 환경
    - 이름 기반
    - 무작위 생성

### 값 객체를 통합 서술력 향상

- 엔티티는 헥사고날 아키텍처의 **일급 객체**다.
- 문제 영역에서 사물을 측정하고 수량화하거나 서술하기 위해 값 객체가 필요하다.
- 내장 타입 외에 잘 정의된 값 객체로 감싸야 한다.

값 객체에 대한 기본 특성은 다음과 같다.

1. 값 객체는 불변이다.
2. 값 객체는 식별자를 갖지 않는다.
- 문제 영역을 잘 설명하기 위해 사용하는 원재료다.
- (원재료만으로는 큰 의미를 만들지는 못한다. = 엔티티와 함께 구성되어야 한다.)

### 애그리게잇을 통한 일관성 보장

- **애그리게잇은**
    - 엔티티와 값 객체의 그룹이 함께 전체적인 개념을 설명하는 경우 사용
    - 내부 객체들은 일관되고 격리된 방식으로 동작
    - 객체의 데이터와 동작을 조정하는 오케스트레이터다.
    - 애그리게잇 영역과 상호작용하는 진입점을 정의해야 한다. → 애그리게잇 루트(Aggregate Root)
    - 바운더리를 통해 내부 객체가 수행하는 동작에서 더 나은 일관성을 보장하도록 한다.
    

### 도메인 서비스 활용

문제 영역 모델링 시 어떤 객체 범주에도 적절하지 않는 상황이 있다. → `도메인 서비스`로 구성할 수 있다.

- 다른 서비스 타입과 구별하는 것이 중요하다.
- 주된 차이점은 범위에 있다.
- 관심사의 분리가 적용되어 있다. (제한된 문제 영역 범위 내에서만 수행한다.)
- 애플리케이션 헥사곤, 프레임워크 헥사곤에서 동작하는 서비스나 다른 객체를 호출해서는 안된다.
- 엔티티와 값 객체에 다소 어울리지 않는 작업을 도메인 서비스를 두어 책임을 위임한다.
    - ex) NetworkOperation 도메인 서비스 클래스

### 정책 패턴과 명세 패턴을 활용한 비즈니스 규칙 처리

- `**정책(Policy)**`
    - 전략으로도 알려져 있다.
    - 코드 블록으로 문제 영역 일부를 캡슐화하는 패턴
    - 제공된 데이터에 대해 어떤 작업이나 처리를 해준다.
    - 의도적으로 엔티티와 값 객체를 분리하고 유지한다.
- `**명세(Specification)**`
    - 조건이나 프레디케이트와 같다.
    - 단순 논리 연산자보다 도 표현적인 방법으로 나타낸다.
    - (isSatisfiedBy, isNetwordAvailable 등..)
    

### POJO를 통한 비즈니스 규칙 정의

- POJO를 사용해 비즈니스 규칙을 모델링해봄으로써 재사용성과 단순성에 관련된 모든 장점을 활용할 수 있다.
- 기술적 세부사항으로부터 도메인 객체를 보호하는 목표와도 관련있다.
- 유연한 설계와 관심사 분리에도 기여